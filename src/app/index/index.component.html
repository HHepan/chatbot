<div class="card shadow-lg chat-card">
  <div class="card-header text-white">
    <h5>Chatbot</h5>
  </div>
  <div class="card-body chat-body" #chatBody>
    <div *ngFor="let msg of messages" class="d-flex mb-3">
      <div *ngIf="msg.role === '1'" class="ms-auto">
        <label class="text-end w-100 small text-muted mb-1">{{ getViewTime(msg.time) }}</label>
        <div class="bg-green text-black p-2 rounded-3">
          {{ msg.content }}
        </div>
      </div>
      <div *ngIf="msg.role === '0'" class="me-auto">
        <label class="text-start w-100 small text-muted mb-1">{{ getViewTime(msg.time) }}</label>
        <div class="bg-light p-2 rounded-3">
          {{ msg.content }}
        </div>
      </div>
    </div>
    <div *ngIf="answerRunning" class="me-auto">
      <div class="bg-light p-2 rounded-3">
        <p>{{ naturalLanguageResult }}</p>
      </div>
    </div>
  </div>
  <div class="card-footer chat-footer d-flex justify-content-between align-items-center">
    <!-- 模式选择: 文本模式 / 语音模式 -->
    <div class=" d-flex ms-auto">
      <div>
        <input class="form-check-input" type="radio" name="mode" id="textMode" value="text" [(ngModel)]="mode" (change)="toggleMode('text')" checked>
        <label for="textMode">
          文本
        </label>
      </div>
      <div>
        <input class="form-check-input" type="radio" name="mode" id="audioMode" value="audio" [(ngModel)]="mode" (change)="toggleMode('audio')">
        <label for="audioMode">
          语音
        </label>
      </div>
    </div>

    <!-- 根据模式显示不同的 UI -->
    <div *ngIf="mode === 'text'" class="input-group">
      <textarea [(ngModel)]="messageContent" class="form-control" rows="3" placeholder="在此输入问题..."></textarea>
      <button class="btn" (click)="sendMessage(messageContent)">发送</button>
    </div>

    <div *ngIf="mode === 'audio'" class="input-group">
      <canvas id="waveform" class="form-control"></canvas>
<!--      <button class="btn" (click)="recording ? stopMic() : startMic()">-->
<!--        {{ recording ? '停止' : '录音' }}-->
<!--      </button>-->
      <textarea [(ngModel)]="speechRecognitionText" class="form-control" rows="3"  placeholder="语音识别结果..." readonly></textarea>
    </div>
  </div>
</div>
